{% extends "configuration.html" %}
{% load static %}

{% block content %}
<button id="darkModeToggle" class="dark-toggle">üåô</button>

<div class="wizard-container">
    <h2>Descubre tu Estilo</h2>
    <p class="step-info">Paso {{ wizard.steps.step1 }} de {{ wizard.steps.count }}</p>
    
    <div class="progress-bar">
      <div class="progress-fill" data-step="{{ wizard.steps.step1 }}"></div>
    </div>

    <form action="" method="post" id="colores-form">{% csrf_token %}
        {{ wizard.management_form }}
        
        <h3>¬øQu√© colores te encantan?</h3>
        <p class="instruction">Elige tus favoritos para crear paletas perfectas</p>

        <!-- Mensaje de error general -->
        {% if wizard.form.colores_fav.errors %}
            <div class="error-message">
                ‚ùå {{ wizard.form.colores_fav.errors|striptags }}
            </div>
        {% endif %}

        <!-- Mensaje de advertencia JavaScript -->
        <div class="warning-message" id="js-warning-message" style="display: none;">
            ‚ö†Ô∏è Te falta seleccionar al menos un color
        </div>

        <div class="choice-grid-horizontal" id="colores-container">
            {% for checkbox in wizard.form.colores_fav %}
                {% with color=checkbox.data.value|upper %}
                <label class="choice-label">
                    {{ checkbox.tag }} 
                    <span class="choice-content color-{{ color|lower }}">
                        <span class="color-box {{ color|lower }}-color"></span>
                        <span class="color-text">{{ checkbox.choice_label }}</span>
                    </span>
                </label>
                {% endwith %}
            {% endfor %}
        </div>
        
        <div class="navigation-buttons">
            {% if wizard.steps.prev %}
                <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" class="btn-style btn-anterior">
                    &lt; Anterior
                </button>
            {% else %}
                <div></div>
            {% endif %}
            
            <button type="submit" class="btn-style btn-continuar" id="continue-btn" disabled>
                Continuar &gt;
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('#colores-container input[type="checkbox"]');
    const continueBtn = document.getElementById('continue-btn');
    const warningMessage = document.getElementById('js-warning-message');
    
    function updateContinueButton() {
        const atLeastOneChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
        continueBtn.disabled = !atLeastOneChecked;
        
        // Mostrar/ocultar mensaje de advertencia
        if (!atLeastOneChecked) {
            warningMessage.style.display = 'block';
        } else {
            warningMessage.style.display = 'none';
        }
        
        // Actualizar clases del bot√≥n
        if (atLeastOneChecked) {
            continueBtn.classList.add('btn-active');
        } else {
            continueBtn.classList.remove('btn-active');
        }
    }
    
    // Agregar evento a cada checkbox
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateContinueButton);
    });
    
    // Validar antes de enviar el formulario
    document.getElementById('colores-form').addEventListener('submit', function(e) {
        const atLeastOneChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
        if (!atLeastOneChecked) {
            e.preventDefault();
            warningMessage.style.display = 'block';
            warningMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
    
    // Verificar estado inicial
    updateContinueButton();
});

// ------------------------------
//     MODO OSCURO
// ------------------------------
function setupDarkMode() {
    const toggleBtn = document.getElementById("darkModeToggle");
    const body = document.body;

    const saved = localStorage.getItem("darkMode");
    if (saved === "enabled") {
        body.classList.add("dark-mode");
        toggleBtn.textContent = "‚òÄÔ∏è";
    }

    toggleBtn.addEventListener("click", () => {
        body.classList.toggle("dark-mode");

        if (body.classList.contains("dark-mode")) {
            localStorage.setItem("darkMode", "enabled");
            toggleBtn.textContent = "‚òÄÔ∏è";
        } else {
            localStorage.setItem("darkMode", "disabled");
            toggleBtn.textContent = "üåô";
        }
    });
}

document.addEventListener("DOMContentLoaded", setupDarkMode);
</script>

<style>
/* Estilos base para el contenedor del wizard */
.wizard-container {
    max-width: 800px;
    margin: 40px auto;
    padding: 30px;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Bot√≥n de continuar */
.btn-continuar:disabled {
    background: var(--medium-color) !important;
    cursor: not-allowed;
    opacity: 0.6;
}

.btn-continuar.btn-active {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%) !important;
    cursor: pointer;
    opacity: 1;
}

/* Grid horizontal para los colores */
.choice-grid-horizontal {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 20px 0;
}

@media (min-width: 768px) {
    .choice-grid-horizontal {
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
    }
}

@media (min-width: 1024px) {
    .choice-grid-horizontal {
        grid-template-columns: repeat(6, 1fr);
        gap: 15px;
    }
}

/* Estilos para las opciones de color */
.choice-label {
    display: block;
    cursor: pointer;
}

.choice-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 8px;
    border-radius: 10px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    /* FONDO COLOR DURAZNO PERMANENTE EN TODAS LAS OPCIONES */
    background: #FFF8DC !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    height: 100%;
    min-height: 90px;
}

/* ESTILO CUANDO SE SELECCIONA - COLOR MORADO VIBRANTE ID√âNTICO AL EJEMPLO */
.choice-label input:checked + .choice-content {
    border-color: #DDA0DD !important; /* Morado vibrante para el borde */
    background: #E6E6FA !important; /* Lavanda - morado vibrante pero suave */
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(221, 160, 221, 0.3);
}

.choice-label:hover .choice-content {
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.color-box {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    margin-bottom: 8px;
    border: 2px solid rgba(0, 0, 0, 0.15);
    transition: transform 0.2s ease;
}

.choice-label input:checked + .choice-content .color-box {
    transform: scale(1.1);
    border-color: rgba(0, 0, 0, 0.3);
    box-shadow: 0 0 8px rgba(221, 160, 221, 0.5);
}

.color-text {
    font-weight: 500;
    text-align: center;
    font-size: 0.85rem;
    line-height: 1.2;
}

/* Paleta de colores vibrante */
.negro-color { background-color: #000000 !important; }
.blanco-color { 
    background-color: #FFFFFF !important; 
    border: 2px solid #E0E0E0 !important;
}
.gris-color { background-color: #696969 !important; }
.beige-color { background-color: #F5DEB3 !important; }
.azul-color { background-color: #4169E1 !important; }
.verde-color { background-color: #32CD32 !important; }
.rojo-color { background-color: #DC143C !important; }
.rosa-color { background-color: #FF69B4 !important; }
.morado-color { background-color: #9370DB !important; }
.amarillo-color { background-color: #FFD700 !important; }
.naranja-color { background-color: #FF8C00 !important; }
.marron-color { background-color: #A0522D !important; }

/* üîò BOT√ìN MODO OSCURO */
.dark-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255,255,255,0.85);
    border: none;
    padding: 10px 12px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    z-index: 5000;
    transition: .3s;
}
.dark-toggle:hover {
    transform: scale(1.15);
}

/* =====================================================
   üåô MODO OSCURO
   ===================================================== */
body.dark-mode {
    background: #1C1A17 !important;
    color: #F5F5DC !important;
}

/* Bot√≥n en oscuro */
body.dark-mode .dark-toggle {
    background: #2A2A2A !important;
    color: #F5F5DC !important;
    border: 1px solid #3B2F2F !important;
}

/* Contenedor principal */
body.dark-mode .wizard-container {
    background: rgba(0,0,0,0.3) !important;
    backdrop-filter: blur(10px);
    border: 1px solid #3B2F2F !important;
}

/* Textos */
body.dark-mode h2,
body.dark-mode h3,
body.dark-mode h4,
body.dark-mode p,
body.dark-mode label {
    color: #F5F5DC !important;
}

body.dark-mode .instruction {
    color: #C0B9A8 !important;
}

/* Las tarjetas de colores - FONDO DURAZNO EN MODO OSCURO TAMBI√âN */
body.dark-mode .choice-content {
    background: #3A2E25 !important; /* Versi√≥n oscura del color durazno */
    border: 1px solid #5A4F4F !important;
    color: #F5F5DC !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

/* Seleccionada en modo oscuro - VERSI√ìN OSCURA DEL MORADO VIBRANTE */
body.dark-mode .choice-label input:checked + .choice-content {
    border-color: #DDA0DD !important; /* Mismo morado vibrante */
    background: #4A3A5A !important; /* Versi√≥n oscura del morado vibrante */
    box-shadow: 0 0 15px rgba(221, 160, 221, 0.5);
}

body.dark-mode .choice-label:hover .choice-content {
    background: #4A3E35 !important;
    border-color: #6A5F5F !important;
}

/* Barra de progreso */
body.dark-mode .progress-bar {
    background: #2A2A2A !important;
    border-color: #3B2F2F !important;
}
body.dark-mode .progress-fill {
    background: #D4AF37 !important;
}

/* Botones */
body.dark-mode .btn-style {
    background: #2A2A2A !important;
    color: #F5F5DC !important;
    border: 1px solid #3B2F2F !important;
}

body.dark-mode .btn-continuar.btn-active {
    background: #D4AF37 !important;
    color: #1C1A17 !important;
}

/* Mensajes de error y advertencia */
body.dark-mode .error-message {
    background-color: #6e2c34;
    color: #F5F5DC;
    border: 1px solid #a9444f;
    padding: 10px;
    border-radius: 6px;
}

body.dark-mode .warning-message {
    background-color: #3B2F2F;
    color: #df8a50;
    border: 1px solid #df8a50;
    padding: 10px;
    border-radius: 6px;
}

/* Ajustes para mejor visualizaci√≥n en m√≥viles */
@media (max-width: 480px) {
    .choice-grid-horizontal {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .choice-content {
        padding: 10px 6px;
        min-height: 80px;
    }
    
    .color-box {
        width: 30px;
        height: 30px;
    }
    
    .color-text {
        font-size: 0.8rem;
    }
}
</style>
{% endblock %}