{% extends "configuration.html" %}
{% load static %}

{% block content %}
<div class="wizard-container">
    <h2>Descubre tu Estilo</h2>
    <p class="step-info">Paso {{ wizard.steps.step1 }} de {{ wizard.steps.count }}</p>
    
    <div class="progress-bar">
      <div class="progress-fill" data-step="{{ wizard.steps.step1 }}"></div>
    </div>

    <form action="" method="post" id="estilos-form">{% csrf_token %}
        {{ wizard.management_form }}
        
        <h3>¬øCu√°l es tu estilo?</h3>
        <p class="instruction">Selecciona todos los que te representen</p>

        <!-- Mensaje de error general -->
        {% if wizard.form.estilos.errors %}
            <div class="error-message">
                ‚ùå {{ wizard.form.estilos.errors|striptags }}
            </div>
        {% endif %}

        <!-- Mensaje de advertencia JavaScript -->
        <div class="warning-message" id="js-warning-message" style="display: none;">
            ‚ö†Ô∏è Te falta seleccionar al menos un estilo
        </div>

        <div class="choice-grid-4" id="estilos-container">
            {% for checkbox in wizard.form.estilos %}
                {% with estilo=checkbox.choice_label|upper %}
                <label class="choice-label">
                    {{ checkbox.tag }} 
                    <span class="choice-content estilo-{{ estilo|lower }}">
                        <div class="style-icon">
                            {% if estilo == "CASUAL" %}üëï
                            {% elif estilo == "FORMAL" %}üëî
                            {% elif estilo == "DEPORTIVO" %}üèÉ
                            {% elif estilo == "ELEGANTE" %}üé©
                            {% elif estilo == "BOHEMIO" %}üå∫
                            {% elif estilo == "STREETWEAR" %}üëü
                            {% elif estilo == "MINIMALISTA" %}‚ö´
                            {% elif estilo == "VINTAGE" %}üìª
                            {% else %}üëï{% endif %}
                        </div>
                        <span class="choice-text">{{ checkbox.choice_label }}</span>
                    </span>
                </label>
                {% endwith %}
            {% endfor %}
        </div>

        <div class="navigation-buttons">
            {% if wizard.steps.prev %}
                <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" class="btn-style btn-anterior">
                    &lt; Anterior
                </button>
            {% else %}
                <div></div>
            {% endif %}
            
            <button type="submit" class="btn-style btn-continuar" id="continue-btn" disabled>
                Continuar &gt;
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('#estilos-container input[type="checkbox"]');
    const continueBtn = document.getElementById('continue-btn');
    const warningMessage = document.getElementById('js-warning-message');
    
    function updateContinueButton() {
        const atLeastOneChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
        continueBtn.disabled = !atLeastOneChecked;
        
        if (!atLeastOneChecked) {
            warningMessage.style.display = 'block';
        } else {
            warningMessage.style.display = 'none';
        }
        
        if (atLeastOneChecked) {
            continueBtn.classList.add('btn-active');
        } else {
            continueBtn.classList.remove('btn-active');
        }
    }
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateContinueButton);
    });
    
    document.getElementById('estilos-form').addEventListener('submit', function(e) {
        const atLeastOneChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
        if (!atLeastOneChecked) {
            e.preventDefault();
            warningMessage.style.display = 'block';
            warningMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
    
    updateContinueButton();
});
</script>

<style>
.style-icon {
    font-size: 2em;
    margin-bottom: 8px;
}

.choice-grid-4 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin: 20px 0;
}

@media (min-width: 768px) {
    .choice-grid-4 {
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
    }
}
</style>
{% endblock %}