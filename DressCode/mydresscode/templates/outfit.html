{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Armar Outfit</title>
  <link rel="stylesheet" href="{% static 'css/outfit.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <!-- ENCABEZADO -->
  <header class="top-bar">
    <div class="header-left">
      <span class="titulo">Recomendaci√≥n de Outfit</span>
    </div>
    <div class="header-center">
      <img src="{% static 'img/logo.png' %}" alt="Logo Mi Armario" />
    </div>
    <div class="theme-toggle-wrapper">
      <button id="theme-toggle" class="theme-button">
          <span class="icon-moon">üåô</span>
          <span class="icon-sun">‚òÄÔ∏è</span>
      </button>
    </div>
    <div class="header-right">
      <a href="{% url 'inicio' %}" class="salir-btn">Salir</a>
    </div>
  </header>

  <!-- NAV DE OPCIONES -->
  <nav class="main-nav">
    <ul>
        <li class="dropdown"
            onmouseover="cargarOpciones('estilo','lista-estilo')"
            onmouseleave="ocultarLista('lista-estilo')">
            <a href="#"><i class="fa-solid fa-shirt"></i> Generar por Estilo</a>
            <ul class="dropdown-list" id="lista-estilo"></ul>
        </li>

        <li class="dropdown"
            onmouseover="cargarOpciones('temporada','lista-temporada')"
            onmouseleave="ocultarLista('lista-temporada')">
            <a href="#"><i class="fa-solid fa-snowflake"></i> Generar por Temporada</a>
            <ul class="dropdown-list" id="lista-temporada"></ul>
        </li>

        <li class="dropdown"
            onmouseover="cargarOpciones('color','lista-color')"
            onmouseleave="ocultarLista('lista-color')">
            <a href="#"><i class="fa-solid fa-palette"></i> Generar por Color</a>
            <ul class="dropdown-list" id="lista-color"></ul>
        </li>

        <li>
            <a href="{% url 'recomendar_outfit' %}">
                <i class="fa-solid fa-wand-magic-sparkles"></i> Generar Outfit Personalizado
            </a>
        </li>
    </ul>
</nav>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="canvas-area">
    <!-- Carrusel autom√°tico -->
    <div class="outfit-carousel-auto">
      <div class="carousel-track">

        {% if outfit.vestido %}
          <div class="outfit-card">
          <img src="{{ outfit.vestido.imagen_segmentada }}" alt="{{ outfit.vestido.tipo }}">
            <span>{{ outfit.vestido.tipo }}</span>
          </div>
        {% else %}
          {% if outfit.parte_superior_base %}
            <div class="outfit-card">
              <img src="{{ outfit.parte_superior_base.imagen_segmentada }}" alt="{{ outfit.parte_superior_base.tipo }}">
              <span>{{ outfit.parte_superior_base.tipo }}</span>
            </div>
          {% else %}
            <div class="outfit-card outfit-vacio">
              <p>No hay parte superior base disponible en este estilo o temporada en tu armario</p>
            </div>
          {% endif %}

          {% if outfit.parte_superior_externo %}
            <div class="outfit-card">
              <img src="{{ outfit.parte_superior_externo.imagen }}" alt="{{ outfit.parte_superior_externo.tipo }}">
              <span>{{ outfit.parte_superior_externo.tipo }}</span>
            </div>
          {% else %}
            <div class="outfit-card outfit-vacio">
              <p>No hay parte superior externa disponible en este estilo o temporada en tu armario</p>
            </div>
          {% endif %}

          {% if outfit.parte_inferior %}
            <div class="outfit-card">
              <img src="{{ outfit.parte_inferior.imagen_segmentada }}" alt="{{ outfit.parte_inferior.tipo }}">
              <span>{{ outfit.parte_inferior.tipo }}</span>
            </div>
          {% else %}
            <div class="outfit-card outfit-vacio">
              <p>No hay parte inferior disponible en este estilo o temporada en tu armario</p>
            </div>
          {% endif %}
        {% endif %}

        {% if outfit.calzado %}
          <div class="outfit-card">
            <img src="{{ outfit.calzado.imagen_segmentada }}" alt="{{ outfit.calzado.tipo }}">
            <span>{{ outfit.calzado.tipo }}</span>
          </div>
        {% else %}
          <div class="outfit-card outfit-vacio">
            <p>No hay calzado disponible en este estilo o temporada en tu armario</p>
          </div>
        {% endif %}

        {% if outfit.accesorios.items %}
          {% for tipo, accesorio in outfit.accesorios.items %}
            <div class="outfit-card">
               <img src="{{ accesorio.imagen_segmentada }}" alt="{{ accesorio.tipo }}">

              <span>{{ accesorio.tipo  }}</span>
            </div>
          {% empty %}
            <div class="outfit-card outfit-vacio">
              <p>No hay accesorios disponibles en este estilo o temporada en tu armario</p>
            </div>
          {% endfor %}
        {% else %}
          <div class="outfit-card outfit-vacio">
            <p>No hay accesorios disponibles en este estilo o temporada en tu armario</p>
          </div>
        {% endif %}

      </div>
    </div>
  </main>

  <!-- FORMULARIO SIMPLIFICADO Y CONFIABLE -->
  <footer class="footer-actions">
    <form id="guardarOutfitForm" method="POST" action="{% url 'guardar_outfit' %}"> 
        {% csrf_token %} 
        
        <!-- PRENDAS - VERSI√ìN SIMPLIFICADA -->
        {% if outfit.vestido %}
            <input type="hidden" name="imagenes" value="{{ outfit.vestido.imagen_segmentada }}"> 
            <input type="hidden" name="tipos" value="Vestido"> 
        {% endif %}
            
        {% if outfit.parte_superior_base %}
            <input type="hidden" name="imagenes" value="{{ outfit.parte_superior_base.imagen_segmentada }}"> 
            <input type="hidden" name="tipos" value="{{ outfit.parte_superior_base.tipo }}"> 
        {% endif %}
            
        {% if outfit.parte_superior_externo %}
            <input type="hidden" name="imagenes" value="{{ outfit.parte_superior_externo.imagen_segmentada}}"> 
            <input type="hidden" name="tipos" value="{{ outfit.parte_superior_externo.tipo }}"> 
        {% endif %}
            
        {% if outfit.parte_inferior %}
            <input type="hidden" name="imagenes" value="{{ outfit.parte_inferior.imagen_segmentada}}"> 
            <input type="hidden" name="tipos" value="{{ outfit.parte_inferior.tipo }}"> 
        {% endif %}
        
        {% if outfit.calzado %}
            <input type="hidden" name="imagenes" value="{{ outfit.calzado.imagen_segmentada }}"> 
            <input type="hidden" name="tipos" value="Calzado"> 
        {% endif %}
        
        {% if outfit.accesorios %}
            {% for tipo, accesorio in outfit.accesorios.items %}
                <input type="hidden" name="imagenes" value="{{ accesorio.imagen_segmentada }}"> 
                <input type="hidden" name="tipos" value="{{ tipo }}"> 
            {% endfor %}
        {% endif %}
        
        <!-- Datos b√°sicos -->
        <input type="hidden" name="estilo" value="Personalizado">
        <input type="hidden" name="clima_recomendado" value="Templado">
        
        <button type="submit" class="save-btn" id="submitBtn">Guardar Outfit</button> 
    </form>

    <a href="{% url 'recomendar_outfit' %}?modo={{ request.GET.modo }}{% if request.GET.estilo %}&estilo={{ request.GET.estilo }}{% endif %}{% if request.GET.temporada %}&temporada={{ request.GET.temporada }}{% endif %}{% if request.GET.ciudad %}&ciudad={{ request.GET.ciudad }}{% endif %}" class="generate-btn">
         Generar nuevo outfit
    </a>
  </footer>

  <!-- MODAL DE GUARDADO EXITOSO -->
  <div id="guardadoModal" class="guardado-modal" style="display: none;">
    <div class="guardado-content">
      <div class="guardado-icon">
        <i class="fa-solid fa-check-circle"></i>
      </div>
      <h3>¬°Outfit Guardado con √âxito!</h3>
      <p class="guardado-message">Tu outfit ha sido guardado en tu colecci√≥n.</p>
      
      <!-- Calificaci√≥n con estrellas -->
      <div class="calificacion-section">
        <p>¬øC√≥mo calificar√≠as este outfit?</p>
        <div class="estrellas-calificacion">
          <span class="estrella" data-value="1">‚òÖ</span>
          <span class="estrella" data-value="2">‚òÖ</span>
          <span class="estrella" data-value="3">‚òÖ</span>
          <span class="estrella" data-value="4">‚òÖ</span>
          <span class="estrella" data-value="5">‚òÖ</span>
        </div>
        <p class="puntuacion-texto">Puntuaci√≥n: <span id="puntuacionMostrada">0</span>/5</p>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="botones-accion">
        <button id="btnIrMisOutfits" class="btn-accion btn-outfits">
          <i class="fa-solid fa-tshirt"></i> Ir a Mis Outfits
        </button>
        <button id="btnIrInicio" class="btn-accion btn-inicio">
          <i class="fa-solid fa-home"></i> Ir a Inicio
        </button>
      </div>
      
      <button id="btnCerrarModal" class="btn-cerrar">
        Cerrar
      </button>
    </div>
  </div>

  <input type="hidden" id="idUsuario" value="{{ request.session.usuario_id }}">
  <input type="hidden" id="idOutfit">

  <script src="{% static 'js/outfit.js' %}"></script>
</body>
</html>